language: node_js
node_js:
  - node
cache: npm

before_script:
  - set -e
  - cd backend
  - npm ci
  - cd ../frontend
  - npm ci
  - npm i codecov
  - cd ..

script:
  - set -e

  # Frontend
  - cd frontend
  - npm test -- --coverage
  - ./node_modules/.bin/codecov
  - npm run build
  - cd ..

  # Backend
  - cd backend
  - npm test
  - npm run apidoc
  - cd ..

deploy:
  provider: pages
  skip-cleanup: true
  github-token: $GITHUB_TOKEN  # Set in travis-ci.org dashboard, marked secure
  keep-history: true
  local-dir: backend/doc
  on:
    branch: master
